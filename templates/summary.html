{% extends 'base.html' %}

{% block title %}Plantilla generada · SSMO{% endblock %}

{% block content %}
  <article class="summary">
    <header class="summary-header">
      <div>
        <h2>Plantilla de registro #{{ registro.id_sic }}</h2>
        <p>Formulario registrado el {{ registro.fecha_creacion.strftime('%d/%m/%Y a las %H:%M') }}</p>
      </div>
      <div class="summary-actions">
        <a class="secondary" href="{{ url_for('listar_formularios') }}">Volver al listado</a>
      </div>
    </header>

    <section class="summary-section">
      <h3>Datos personales</h3>
      <dl>
        <div><dt>Nombre</dt><dd>{{ registro.paciente.nombre }}</dd></div>
        <div><dt>RUT paciente</dt><dd>{{ registro.paciente.rut_pac or '-' }}</dd></div>
        <div><dt>Historia clínica</dt><dd>{{ registro.paciente.historia_clinica or '-' }}</dd></div>
        <div><dt>Sexo</dt><dd>{{ registro.paciente.sexo or '-' }}</dd></div>
        <div><dt>Fecha de nacimiento</dt><dd>{{ registro.paciente.fecha_nacimiento.strftime('%d/%m/%Y') if registro.paciente.fecha_nacimiento else '-' }}</dd></div>
        <div><dt>Edad</dt><dd>{{ registro.paciente.edad or '-' }}</dd></div>
        <div><dt>Domicilio</dt><dd>{{ registro.paciente.domicilio or '-' }}</dd></div>
        <div><dt>Comuna</dt><dd>{{ registro.paciente.comuna or '-' }}</dd></div>
        <div><dt>Teléfonos</dt><dd>{{ registro.paciente.telefono1 or '-' }}{% if registro.paciente.telefono2 %} / {{ registro.paciente.telefono2 }}{% endif %}</dd></div>
        <div><dt>Correos</dt><dd>{{ registro.paciente.correo1 or '-' }}{% if registro.paciente.correo2 %} / {{ registro.paciente.correo2 }}{% endif %}</dd></div>
      </dl>
    </section>

    <section class="summary-section">
      <h3>Información médica</h3>
      <dl>
        <div><dt>Establecimiento de Origen</dt><dd>{{ registro.establecimiento_origen.nombre or '-' }}</dd></div>
        <div><dt>Establecimiento de Destino</dt><dd>{{ registro.establecimiento_destino.nombre or '-' }}</dd></div>
        <div><dt>Tipo de consulta</dt><dd>{{ registro.tipo_consulta or '-' }}</dd></div>
        <div><dt>Especialidad de Origen</dt><dd>{{ registro.especialidad_orig or '-' }}</dd></div>
        <div><dt>Especialidad de Destino</dt><dd>{{ registro.especialidad_dest or '-' }}</dd></div>
        <div><dt>Hipótesis diagnóstica</dt><dd>{{ registro.diagnostico or '-' }}</dd></div>
        <div><dt>Exámenes realizados</dt><dd>{{ registro.examenes or '-' }}</dd></div>
        <div><dt>¿Caso GES?</dt><dd>{{ registro.ges or '-' }}</dd></div>
        <div><dt>Patologías GES</dt>
          <dd>
            {% set patologias = registro.ges_des.split(';') if registro.ges_des else [] %}
            {% if patologias %}
              <ul>
                {% for patologia in patologias %}
                  {% if patologia %}
                    <li>{{ patologia }}</li>
                  {% endif %}
                {% endfor %}
              </ul>
            {% else %}
              No aplica.
            {% endif %}
          </dd>
        </div>
        <div><dt>Prioridad</dt><dd>{{ registro.prioridad or '-' }}</dd></div>
      </dl>
    </section>

    <section class="summary-section">
      <h3>Profesional responsable</h3>
      <dl>
        <div><dt>Nombre médico</dt><dd>{{ registro.profesional.nombre or '-' }}</dd></div>
        <div><dt>RUT médico</dt><dd>{{ registro.profesional.rut_pro or '-' }}</dd></div>
        <div><dt>Especialidad</dt><dd>{{ registro.profesional.especialidad or '-' }}</dd></div>
      </dl>
    </section>

    <section class="summary-section">
      <h3>Texto para copiar</h3>
      <textarea readonly rows="15" class="summary-text">{{ registro.resumen_texto() }}</textarea>
    </section>
  </article>
{% endblock %}