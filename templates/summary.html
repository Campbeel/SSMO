{% extends 'base.html' %}

{% block title %}Detalle de Registro · SSMO{% endblock %}

{% block content %}
  <article class="summary">
    <header class="summary-header">
      <div>
        <h2>Detalle de Registro de Interconsulta</h2>
        <p>Formulario registrado el {{ registro.fecha_creacion.strftime('%d/%m/%Y a las %H:%M') }}</p>
      </div>
      <div class="summary-actions">
        <a class="secondary" href="{{ url_for('listar_formularios') }}">Volver al listado</a>
      </div>
    </header>

    <section class="summary-section">
      <h3>Datos del Paciente</h3>
      <dl>
        <div><dt>Nombre Completo</dt><dd>{{ registro.paciente.nombre }}</dd></div>
        <div><dt>RUT</dt><dd>{{ registro.paciente.rut_pac or '-' }}</dd></div>
        <div><dt>Nº Historia Clínica</dt><dd>{{ registro.paciente.historia_clinica or '-' }}</dd></div>
        <div><dt>Fecha de Nacimiento</dt><dd>{{ registro.paciente.fecha_nacimiento.strftime('%d-%m-%Y') if registro.paciente.fecha_nacimiento else '-' }}</dd></div>
        <div><dt>Sexo</dt><dd>{{ registro.paciente.sexo or '-' }}</dd></div>
        <div><dt>Domicilio</dt><dd>{{ registro.paciente.domicilio or '-' }}</dd></div>
        <div><dt>Comuna</dt><dd>{{ registro.paciente.comuna or '-' }}</dd></div>
        <div><dt>Teléfono(s)</dt><dd>{{ registro.paciente.telefono1 or '-' }}{% if registro.paciente.telefono2 %} / {{ registro.paciente.telefono2 }}{% endif %}</dd></div>
        <div><dt>Correo(s)</dt><dd>{{ registro.paciente.correo1 or '-' }}{% if registro.paciente.correo2 %} / {{ registro.paciente.correo2 }}{% endif %}</dd></div>
      </dl>
    </section>

    <section class="summary-section">
      <h3>Datos de la Derivación (SIC)</h3>
      <dl>
        <div><dt>Establecimiento Origen</dt><dd>{{ registro.establecimiento_origen.nombre or '-' }}</dd></div>
        <div><dt>Especialidad Origen</dt><dd>{{ registro.especialidad_orig or '-' }}</dd></div>
        <div><dt>Establecimiento Destino</dt><dd>{{ registro.establecimiento_destino.nombre or '-' }}</dd></div>
        <div><dt>Especialidad Destino</dt><dd>{{ registro.especialidad_dest or '-' }}</dd></div>
        <div><dt>Tipo de Consulta</dt><dd>{{ registro.tipo_consulta or '-' }}</dd></div>
        <div><dt>Prioridad</dt><dd>{{ registro.prioridad or '-' }}</dd></div>
        <div><dt>Hipótesis Diagnóstica</dt><dd>{{ registro.diagnostico or '-' }}</dd></div>
        <div><dt>Exámenes Realizados</dt><dd>{{ registro.examenes or '-' }}</dd></div>
        <div><dt>¿Caso GES?</dt><dd>{{ registro.ges or '-' }}</dd></div>
        <div><dt>Patologías GES</dt>
          <dd>
            {% if registro.ges_des %}
              <ul>
                {% for patologia in registro.ges_des.split(';') %}
                  {% if patologia.strip() %}
                    <li>{{ patologia.strip() }}</li>
                  {% endif %}
                {% endfor %}
              </ul>
            {% else %}
              Sin patologías GES registradas.
            {% endif %}
          </dd>
        </div>
      </dl>
    </section>

    <section class="summary-section">
      <h3>Profesional Responsable</h3>
      <dl>
        <div><dt>Nombre Profesional</dt><dd>{{ registro.profesional.nombre or '-' }}</dd></div>
        <div><dt>RUT Profesional</dt><dd>{{ registro.profesional.rut_pro or '-' }}</dd></div>
      </dl>
    </section>

  </article>
{% endblock %}